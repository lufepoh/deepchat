
# Deepchat 데이터 동기화 기능 설명 문서

## 기능 개요

데이터 동기화 기능은 사용자가 애플리케이션의 데이터(채팅 기록 및 설정 정보 포함)를 지정된 동기화 폴더에 백업하고, 다른 장치에서 해당 데이터를 가져올 수 있도록 합니다. 이 기능은 다음과 같은 시나리오에서 유용하게 사용됩니다:

1. 데이터 백업: 데이터 손실 방지
2. 장치 간 동기화: 여러 장치 간 동일한 채팅 기록 및 설정 공유
3. 데이터 이전: 장치를 변경하거나 시스템을 재설치할 때 데이터 마이그레이션

## 기술적 구현

### 핵심 구성요소

1. **SyncPresenter**: 동기화 로직을 처리하는 주요 클래스, 백업 및 가져오기 기능 포함
2. **ConfigPresenter 확장**: 동기화 관련 설정 항목이 추가됨
3. **DataSettings.vue**: 사용자에게 동기화 설정을 제어할 수 있는 UI 제공

### 데이터 흐름

#### 백업 흐름

1. 사용자가 동기화 기능을 활성화하고 동기화 폴더를 설정함
2. 데이터 변경 발생 시(예: 메시지 추가/수정, 대화 생성 등), 일정 시간(기본 60초) 동안 변화가 없으면 자동으로 백업 수행
3. 백업 중에는 임시 파일을 먼저 생성하고 완료 후 최종 파일로 교체하여 가져오기 중 파일 충돌을 방지함
4. 백업되는 데이터 항목:
   - 데이터베이스 파일(chat.db)
   - 설정 파일들(xxx.json, provider-models/xxx.json 등)

#### 가져오기 흐름

1. 사용자가 설정 화면에서 "데이터 가져오기" 클릭
2. 시스템이 동기화 폴더에 유효한 백업 파일이 있는지 확인
3. 가져오기 전에 현재 데이터를 백업하여 실패 시 복구 가능
4. 가져오기 완료 후 애플리케이션을 재시작해야 변경 사항이 반영됨

### 보안 조치

1. 백업 과정에서 임시 파일을 사용하여 파일 충돌 방지
2. 가져오기 전에 현재 데이터를 백업하여 복원 가능성 확보
3. 동기화 폴더 경로는 동기화 대상에서 제외되어 장치 간 경로 충돌 방지
4. 백업 및 가져오기 작업에는 오류 처리 및 상태 피드백이 포함됨

## 사용자 인터페이스

데이터 동기화 UI는 설정 페이지의 "데이터" 탭에 위치하며 다음 기능을 포함합니다:

1. 동기화 기능 스위치: 동기화 기능 켜기/끄기
2. 동기화 폴더 설정: 데이터 백업 대상 폴더 선택
3. 동기화 폴더 열기: 파일 탐색기로 동기화 폴더 열기
4. 마지막 동기화 시간: 최근 백업 시각 표시
5. 수동 백업: 사용자가 직접 백업 실행
6. 데이터 가져오기: 동기화 폴더에서 데이터 가져오기 (기본적으로 증분 가져오기)
   - **증분 가져오기**: 기존 채팅 데이터를 덮어쓰지 않고, 동일한 채팅이 중복 저장되지 않음. 예: 1월 1일 백업을 가져온 후 1월 2일 백업을 다시 가져와도 1월 1일 대화는 중복되지 않음
   - **덮어쓰기 가져오기**: 현재 채팅 데이터를 덮어쓰고 새 데이터를 가져옴

## 이벤트 시스템

시스템은 이벤트 메커니즘을 통해 백업 및 가져오기 상태를 알립니다:

1. `sync:backup-started`: 백업 시작
2. `sync:backup-completed`: 백업 완료
3. `sync:backup-error`: 백업 오류 발생
4. `sync:import-started`: 가져오기 시작
5. `sync:import-completed`: 가져오기 완료
6. `sync:import-error`: 가져오기 오류

이 이벤트들은 메인 프로세스와 렌더러 프로세스 간에 전달되어 UI에서 실시간으로 동기화 상태를 표시할 수 있도록 합니다.

## 설정 항목

동기화 기능과 관련된 설정 항목:

1. `syncEnabled`: 동기화 기능 활성화 여부 (boolean)
2. `syncFolderPath`: 동기화 폴더 경로 (string)
3. `lastSyncTime`: 마지막 동기화 시간 (timestamp)

이 항목들은 애플리케이션 설정 파일에 저장되며, `syncFolderPath`는 백업 시 제외되어 장치 간 경로 충돌을 방지합니다.

## 사용 권장 사항

1. 안정적인 저장소(예: 클라우드 동기화 폴더)를 동기화 폴더로 선택
2. 주기적으로 백업 상태 확인하여 데이터가 정상적으로 저장되는지 확인
3. 데이터 가져오기 전에 애플리케이션의 중요한 미저장 데이터를 확인
4. 가져오기 완료 후 애플리케이션을 재시작하여 변경 사항 적용

## 제한 사항 및 주의 사항

1. 동기화 기능은 실시간 동기화를 하지 않으며, 데이터 변경 후 일정 시간(기본 60초)이 지난 뒤 백업 수행됨 (현재는 비활성화됨, IO 과다 발생으로 성능 저하 있음)
2. 가져오기 작업은 현재 모든 데이터를 교체함 (채팅 기록 및 설정 포함)
3. 동기화 폴더 경로는 동기화되지 않으며, 각 장치에서 별도로 설정 필요
4. 데이터 가져오기 후 애플리케이션 재시작이 필요함
